ТЕХНИЧЕСКОЕ ОПИСАНИЕ ПРИЛОЖЕНИЯ
"СИСТЕМА УЧЕТА ДЕТЕЙ В ДЕТСКОМ САДУ"

1. ВЫБОР ЯЗЫКА ПРОГРАММИРОВАНИЯ И ОБОСНОВАНИЕ

Для разработки приложения для учета посещаемости детей в детских садах был выбран язык программирования Python, что обосновано его популярностью, универсальностью и множеством преимуществ. Python является одним из самых востребованных языков программирования, благодаря своей простоте в освоении, читаемости кода и большому количеству доступных библиотек. Эти характеристики делают его отличным выбором для разработки систем, в том числе тех, которые требуют работы с базами данных, создания графических интерфейсов и выполнения различных аналитических задач.

2. ИСПОЛЬЗУЕМЫЕ БИБЛИОТЕКИ

2.1. Flet (>=0.21.0)
- Основная библиотека для создания графического интерфейса
- Позволяет создавать кроссплатформенные приложения (Windows, macOS, Linux, Web, Android, iOS)
- Использует Flutter под капотом для рендеринга UI
- Поддерживает адаптивный дизайн и темную/светлую темы

2.2. Peewee (>=3.17.0)
- ORM (Object-Relational Mapping) для работы с базой данных SQLite
- Упрощает работу с базой данных через объектно-ориентированный подход
- Поддерживает миграции и транзакции

2.3. Стандартные библиотеки Python:
- datetime: работа с датами и временем
- hashlib: хеширование паролей (SHA-256)
- json: работа с JSON-данными для экспорта
- csv: экспорт данных в CSV формат
- shutil: операции с файлами (резервное копирование)
- threading: многопоточность для фоновых операций

3. АРХИТЕКТУРА ПРИЛОЖЕНИЯ

3.1. Структура проеков:
kursach-main/
├── main.py                 # Точка входа в приложение
├── database.py            # Модели базы данных и ORM
├── settings/
│   ├── config.py         # Конфигурация приложения
│   └── logger.py         # Система логирования
├── view/                  # Представления (UI компоненты)
│   ├── login_view.py
│   ├── children_view.py
│   ├── child_detail_view.py
│   ├── parents_view.py
│   ├── parent_detail_view.py
│   ├── teachers_view.py
│   ├── teacher_detail_view.py
│   ├── groups_view.py
│   ├── events_view.py
│   ├── event_detail_view.py
│   ├── attendance_view.py
│   ├── medical_card_view.py
│   ├── users_view.py
│   ├── logs_view.py
│   └── settings_view.py
├── components/            # Переиспользуемые компоненты
│   └── search_bar.py
├── dialogs/              # Диалоговые окна
│   └── confirm_dialog.py
└── pages_styles/         # Стили для страниц
    └── styles.py

4. ИЕРАРХИЯ КЛАССОВ

4.1. Базовые классы Flet:
- ft.Container: базовый контейнер для всех view-классов
- ft.UserControl: базовый класс для пользовательских компонентов
- ft.AlertDialog: диалоговые окна
- ft.BottomSheet: всплывающие панели снизу

4.2. Модели базы данных (наследуются от peewee.Model):

BaseModel (peewee.Model):
  - Базовая модель для всех таблиц
  - Атрибуты: database = db
  - Назначение: определяет общую конфигурацию для всех моделей

User (BaseModel):
  - Модель пользователя системы
  - Поля:
    * user_id: AutoField (первичный ключ)
    * username: CharField (уникальное, обязательное)
    * password: CharField (хеш SHA-256, обязательное)
    * role: CharField (admin/user, по умолчанию admin)
    * group: ForeignKey -> Group (опционально, для привязки к группе)
    * created_at: DateTimeField (дата создания)
  - Связи: один-ко-многим с UserPermission, многие-к-одному с Group
  - Назначение: хранение учетных записей пользователей

UserPermission (BaseModel):
  - Модель прав доступа пользователя
  - Поля:
    * user: ForeignKey -> User
    * page_name: CharField (название страницы)
    * can_access: BooleanField (разрешен ли доступ)
  - Первичный ключ: составной (user, page_name)
  - Связи: многие-к-одному с User
  - Назначение: гранулярное управление доступом к страницам

Child (BaseModel):
  - Модель ребенка
  - Поля:
    * child_id: AutoField (первичный ключ)
    * last_name: CharField (обязательное)
    * first_name: CharField (обязательное)
    * middle_name: CharField (опционально)
    * birth_date: DateField (обязательное)
    * gender: CharField (М/Ж, с ограничением CHECK)
    * group: ForeignKey -> Group (опционально)
    * enrollment_date: DateField (дата зачисления, обязательное)
    * created_at: DateTimeField (дата создания)
  - Индексы: составной индекс (last_name, first_name)
  - Связи: многие-к-одному с Group, один-ко-многим с AttendanceRecord, MedicalRecord
  - Назначение: хранение информации о детях

Parent (BaseModel):
  - Модель родителя
  - Поля:
    * parent_id: AutoField (первичный ключ)
    * last_name: CharField (обязательное)
    * first_name: CharField (обязательное)
    * middle_name: CharField (опционально)
    * phone: CharField (опционально)
    * email: CharField (опционально)
    * address: CharField (опционально)
    * created_at: DateTimeField (дата создания)
  - Связи: многие-ко-многим с Child через ParentChild
  - Назначение: хранение информации о родителях

ParentChild (BaseModel):
  - Модель связи родитель-ребенок (many-to-many)
  - Поля:
    * parent: ForeignKey -> Parent
    * child: ForeignKey -> Child
    * relationship: CharField (Мама/Папа/Опекун и т.д.)
    * created_at: DateTimeField (дата создания)
  - Первичный ключ: составной (parent, child)
  - Назначение: связь родителей и детей с указанием степени родства

Teacher (BaseModel):
  - Модель воспитателя
  - Поля:
    * teacher_id: AutoField (первичный ключ)
    * last_name: CharField (обязательное)
    * first_name: CharField (обязательное)
    * middle_name: CharField (опционально)
    * phone: CharField (опционально)
    * email: CharField (опционально)
    * birth_date: CharField (опционально)
    * address: TextField (опционально)
    * education: TextField (образование, опционально)
    * experience: IntegerField (стаж работы, опционально)
    * created_at: DateTimeField (дата создания)
  - Связи: один-ко-многим с Group, многие-ко-многим с Group через GroupTeacher
  - Назначение: хранение информации о воспитателях

Group (BaseModel):
  - Модель группы детского сада
  - Поля:
    * group_id: AutoField (первичный ключ)
    * group_name: CharField (обязательное)
    * age_category: CharField (возрастная категория, обязательное)
    * teacher: ForeignKey -> Teacher (опционально, устаревшее)
    * created_at: DateTimeField (дата создания)
  - Связи: многие-к-одному с Teacher, один-ко-многим с Child, User
  - Связи many-to-many: с Teacher через GroupTeacher
  - Назначение: хранение информации о группах

GroupTeacher (BaseModel):
  - Модель связи группа-воспитатель (many-to-many)
  - Поля:
    * group: ForeignKey -> Group
    * teacher: ForeignKey -> Teacher
    * created_at: DateTimeField (дата создания)
  - Первичный ключ: составной (group, teacher)
  - Назначение: связь групп и воспитателей (один воспитатель может работать в нескольких группах)

AttendanceRecord (BaseModel):
  - Модель записи посещаемости
  - Поля:
    * record_id: AutoField (первичный ключ)
    * child: ForeignKey -> Child
    * date: DateField (обязательное)
    * status: CharField (Присутствует/Отсутствует/Болеет)
    * notes: TextField (примечания, опционально)
    * created_at: DateTimeField (дата создания)
    * updated_at: DateTimeField (дата обновления)
  - Индексы: уникальный составной индекс (child, date)
  - Связи: многие-к-одному с Child
  - Назначение: учет посещаемости детей

MedicalRecord (BaseModel):
  - Модель медицинской карты
  - Поля:
    * record_id: AutoField (первичный ключ)
    * child: ForeignKey -> Child
    * blood_type: CharField (группа крови, опционально)
    * allergies: TextField (аллергии, опционально)
    * chronic_diseases: TextField (хронические заболевания, опционально)
    * vaccinations: TextField (прививки, опционально)
    * height: FloatField (рост в см, опционально)
    * weight: FloatField (вес в кг, опционально)
    * doctor_notes: TextField (замечания врача, опционально)
    * emergency_contact: CharField (контакт для экстренных случаев, опционально)
    * last_checkup: DateField (последний осмотр, опционально)
    * created_at: DateTimeField (дата создания)
    * updated_at: DateTimeField (дата обновления)
  - Связи: многие-к-одному с Child
  - Назначение: хранение медицинской информации о детях

4.3. Класс для работы с БД:

KindergartenDB:
  - Основной класс для работы с базой данных
  - Что делает:
    * Управляет подключением к SQLite базе данных
    * Создает и обновляет структуру таблиц
    * Делегирует операции CRUD специализированным классам-настройкам
    * Обеспечивает аутентификацию пользователей
    * Управляет связями many-to-many между сущностями
    * Предоставляет единую точку доступа ко всем операциям с БД
  - Атрибуты:
    * db_path: путь к файлу SQLite
    * connection: объект подключения
    * _children_settings: делегат для работы с детьми
    * _teachers_settings: делегат для работы с воспитателями
    * _parents_settings: делегат для работы с родителями
    * _groups_settings: делегат для работы с группами
    * _attendance_settings: делегат для работы с посещаемостью
    * _medical_card_settings: делегат для работы с медкартами
  - Методы:
    * connect(): установка соединения
    * close(): закрытие соединения
    * create_tables(): создание таблиц и миграции
    * authenticate_user(): аутентификация
    * get_user_permissions(): получение прав доступа
    * add_parent_child_relation(): связь родитель-ребенок
    * add_group_teacher_relation(): связь группа-воспитатель
    * __getattr__(): динамическое делегирование методов
  - Назначение: централизованное управление всеми операциями с БД

4.4. View-классы (наследуются от ft.Container):

LoginView (ft.Container):
  - Экран авторизации
  - Что делает:
    * Отображает форму входа с полями логина и пароля
    * Проверяет учетные данные через базу данных
    * Сохраняет данные сессии в client_storage
    * Логирует попытки входа (успешные и неудачные)
    * Перенаправляет на главный экран при успешной авторизации
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * on_success: callback при успешном входе
    * page: объект страницы Flet
    * username_field: поле ввода логина
    * password_field: поле ввода пароля
  - Методы:
    * on_login_click(e): обработка нажатия кнопки "Войти"
    * on_password_key_press(e): обработка Enter
  - Назначение: аутентификация пользователей

ChildrenView (ft.Container):
  - Список детей с формой добавления/редактирования
  - Что делает:
    * Отображает список всех детей с пагинацией (8 элементов на страницу)
    * Фильтрует детей по группе пользователя (если не администратор)
    * Предоставляет поиск по ФИО ребенка
    * Позволяет добавлять новых детей через форму
    * Открывает детальное представление при клике на ребенка
    * Удаляет детей с подтверждением (только для администраторов)
    * Логирует все операции создания и удаления
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * page: объект страницы
    * user_group_id: ID группы пользователя (для фильтрации)
    * selected_child: выбранный ребенок для редактирования
    * current_page: текущая страница пагинации
    * items_per_page: количество элементов на странице (8)
    * all_children: список всех детей
    * search_query: текущий поисковый запрос
  - Методы:
    * load_children(search_query): загрузка списка
    * show_add_form(e): показать форму добавления
    * save_child(e): сохранить ребенка
    * delete_child(child_id): удалить ребенка
    * show_child_detail(child_id): показать детальную информацию
    * on_search(query): поиск
    * prev_page(e), next_page(e): пагинация
    * update_pagination(): обновление пагинации
  - Назначение: управление списком детей

ChildDetailView (ft.Container):
  - Детальная информация о ребенке с вкладками
  - Что делает:
    * Отображает полную информацию о ребенке в трех вкладках
    * Вкладка "Общая информация": ФИО, дата рождения, возраст, пол, группа
    * Вкладка "Медкарта": встроенный компонент MedicalCardView
    * Вкладка "Родители": список родителей с возможностью управления
    * Позволяет редактировать информацию о ребенке
    * Управляет связями ребенок-родитель с указанием степени родства
    * Автоматически вычисляет возраст ребенка
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * child_id: ID ребенка
    * child: данные ребенка
    * tabs: компонент вкладок
    * parents_column: колонка с родителями
  - Методы:
    * _create_info_tab(): вкладка с общей информацией
    * _create_medical_tab(): вкладка с медкартой
    * _create_parents_tab(): вкладка с родителями
    * edit_child(e): редактирование
    * manage_parents(e): управление родителями
    * _load_parents(): загрузка родителей
  - Назначение: просмотр и редактирование информации о ребенке

ParentsView (ft.Container):
  - Список родителей с формой добавления/редактирования
  - Что делает:
    * Отображает список родителей с пагинацией
    * Фильтрует родителей по детям из группы пользователя
    * Показывает родителей без детей (новых)
    * Предоставляет поиск по ФИО родителя
    * Форматирует телефонные номера с кодом страны (+7, +375, +1)
    * Автоматически применяет маски ввода для телефонов
    * Валидирует обязательные поля (ФИО)
    * Открывает детальное представление при клике
  - Атрибуты: аналогично ChildrenView
  - Методы:
    * load_parents(search_query): загрузка списка
    * show_add_form(e): показать форму
    * save_parent(e): сохранить родителя
    * delete_parent(parent_id): удалить
    * show_parent_detail(parent_id): детальная информация
    * format_phone(e): форматирование телефона
    * update_phone_hint(e): обновление подсказки
  - Назначение: управление списком родителей

ParentDetailView (ft.Container):
  - Детальная информация о родителе с вкладками
  - Что делает:
    * Отображает информацию о родителе в двух вкладках
    * Вкладка "Общая информация": ФИО, телефон, email, адрес
    * Вкладка "Дети": список детей родителя с информацией о группе
    * Позволяет редактировать информацию (доступно всем пользователям)
    * Управляет связями родитель-ребенок
    * Форматирует телефонные номера при редактировании
    * Использует AlertDialog для вложенных форм
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * parent_id: ID родителя
    * parent_data: данные родителя
    * tabs: компонент вкладок
    * children_column: колонка с детьми
  - Методы:
    * _create_info_tab(): вкладка с информацией
    * _create_children_tab(): вкладка с детьми
    * edit_parent(e): редактирование
    * manage_children(e): управление детьми
    * format_phone(e): форматирование телефона
  - Назначение: просмотр и редактирование информации о родителе

TeachersView (ft.Container):
  - Список воспитателей
  - Что делает:
    * Отображает список воспитателей с пагинацией
    * Фильтрует по группе пользователя (если не администратор)
    * Предоставляет поиск по ФИО
    * Позволяет добавлять воспитателей (только администраторам)
    * Показывает образование и стаж работы
    * Ограничивает удаление только для администраторов
    * Открывает детальное представление для просмотра
  - Атрибуты: аналогично ChildrenView
  - Методы: аналогично ChildrenView
  - Назначение: управление списком воспитателей

TeacherDetailView (ft.Container):
  - Детальная информация о воспитателе с вкладками
  - Что делает:
    * Отображает информацию в двух вкладках
    * Вкладка "Общая информация": ФИО, контакты, образование, стаж
    * Вкладка "Группы": список групп, где работает воспитатель
    * Позволяет редактировать (только администраторам)
    * Показывает все группы через many-to-many связь
  - Вкладки: Общая информация, Группы
  - Назначение: просмотр и редактирование информации о воспитателе

GroupsView (ft.Container):
  - Список групп с формой добавления/редактирования
  - Что делает:
    * Отображает список групп с информацией о воспитателях
    * Позволяет назначать нескольких воспитателей на одну группу
    * Использует чекбоксы для выбора воспитателей
    * Управляет many-to-many связями через GroupTeacher
    * Показывает возрастную категорию группы
    * Отображает количество детей в группе
    * Фильтрует группы для обычных пользователей
  - Особенности: поддержка множественного выбора воспитателей
  - Методы:
    * _load_teachers_for_form(): загрузка воспитателей
    * _update_group_teachers(group_id): обновление связей
  - Назначение: управление группами

AttendanceView (ft.Container):
  - Учет посещаемости
  - Что делает:
    * Отображает список детей группы на выбранную дату
    * Позволяет отмечать статус: Присутствует/Отсутствует/Болен/Отпуск
    * Сохраняет примечания к каждой записи
    * Автоматически создает/обновляет записи посещаемости
    * Фильтрует детей по группе пользователя
    * Использует DatePicker для выбора даты
    * Предотвращает дублирование записей (уникальный индекс)
  - Атрибуты:
    * selected_date: выбранная дата
    * attendance_data: данные посещаемости
  - Методы:
    * on_date_change(e): изменение даты
    * load_attendance(): загрузка данных
    * save_attendance(e): сохранение
    * on_status_change(e): изменение статуса
  - Назначение: отметка посещаемости детей

EventsView (ft.Container):
  - Список мероприятий
  - Что делает:
    * Отображает список мероприятий с датами
    * Фильтрует по группе пользователя
    * Позволяет создавать новые мероприятия
    * Показывает описание и участников
    * Удаляет мероприятия (только администраторам)
    * Открывает детальное представление
  - Назначение: управление мероприятиями

EventDetailView (ft.Container):
  - Детальная информация о мероприятии
  - Что делает:
    * Отображает информацию в двух вкладках
    * Вкладка "Общая информация": название, дата, описание
    * Вкладка "Участники": список детей по группам
    * Позволяет редактировать (только администраторам)
    * Управляет списком участников мероприятия
  - Вкладки: Общая информация, Участники
  - Назначение: просмотр и редактирование мероприятия

MedicalCardView (ft.Container):
  - Медицинская карта ребенка
  - Что делает:
    * Отображает медицинскую информацию о ребенке
    * Показывает: группу крови, аллергии, хронические заболевания
    * Отображает: прививки, рост, вес, замечания врача
    * Позволяет редактировать медицинскую информацию
    * Сохраняет контакт для экстренных случаев
    * Отслеживает дату последнего осмотра
    * Может работать в режиме встраивания (без кнопки закрытия)
  - Атрибуты:
    * child_id: ID ребенка
    * embedded: режим встраивания
  - Назначение: просмотр и редактирование медкарты

UsersView (ft.Container):
  - Управление пользователями (только для администраторов)
  - Что делает:
    * Отображает список всех пользователей системы
    * Показывает роль и назначенную группу
    * Позволяет создавать новых пользователей
    * Назначает роли (admin/user)
    * Привязывает пользователей к группам
    * Хеширует пароли при создании (SHA-256)
    * Удаляет пользователей с подтверждением
    * Логирует все операции с пользователями
  - Назначение: создание, редактирование, удаление пользователей

LogsView (ft.Container):
  - Журнал действий
  - Что делает:
    * Отображает историю всех действий в системе
    * Фильтрует по пользователю (выпадающий список)
    * Фильтрует по типу действия (LOGIN, CREATE, UPDATE, DELETE и т.д.)
    * Ограничивает количество записей (50/100/200/500)
    * Сохраняет выбранный лимит в client_storage
    * Показывает дату, время, пользователя, действие, детали
    * Форматирует вывод в виде таблицы
  - Атрибуты:
    * user_filter: фильтр по пользователю
    * action_filter: фильтр по действию
    * limit: лимит записей
  - Назначение: просмотр истории действий

SettingsView (ft.Container):
  - Настройки приложения
  - Что делает:
    * Управляет темой приложения (светлая/темная)
    * Экспортирует данные в JSON (все таблицы)
    * Экспортирует данные в CSV (отдельные таблицы)
    * Создает резервные копии базы данных
    * Очищает все данные (с подтверждением)
    * Очищает журнал действий
    * Показывает статистику (количество записей)
    * Ограничивает опасные операции для администраторов
  - Методы:
    * export_json(e): экспорт в JSON
    * export_csv(e): экспорт в CSV
    * backup_db(e): резервное копирование
    * clear_data(e): очистка данных
    * change_theme(e): смена темы
  - Назначение: управление данными и настройками

4.5. Компоненты:

SearchBar (ft.UserControl):
  - Компонент поиска с иконкой
  - Что делает:
    * Отображает поле ввода с иконкой поиска
    * Вызывает callback при изменении текста
    * Предоставляет единообразный интерфейс поиска
    * Поддерживает placeholder текст
  - Атрибуты:
    * on_search: callback для поиска
    * placeholder: текст подсказки
  - Назначение: унифицированный поиск

AppStyles:
  - Статические методы для создания стилизованных элементов
  - Что делает:
    * Создает единообразные поля ввода
    * Генерирует текст ошибок с красным цветом
    * Формирует колонки форм с прокруткой
    * Создает заголовки страниц с кнопками
    * Обеспечивает консистентность дизайна
  - Методы:
    * text_field(label, required, autofocus): создание поля ввода
    * error_text(): создание текста ошибки
    * form_column(controls, spacing): создание колонки формы
    * page_header(title, button_text, on_click): создание заголовка
  - Назначение: единообразие стилей

AppNavigationDrawer (ft.NavigationDrawer):
  - Боковое меню навигации
  - Что делает:
    * Отображает список доступных страниц
    * Фильтрует пункты меню по правам доступа
    * Скрывает административные разделы от обычных пользователей
    * Переключает представления при клике
    * Автоматически закрывается после выбора
    * Показывает иконки для каждого раздела
  - Атрибуты:
    * switch_view: callback для переключения
    * is_admin: флаг администратора
    * user_permissions: права доступа
  - Назначение: навигация по приложению_relation(): связь группа-воспитатель
    * __getattr__(): динамическое делегирование методов
  - Назначение: централизованное управление всеми операциями с БД

4.4. View-классы (наследуются от ft.Container):

LoginView (ft.Container):
  - Экран авторизации
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * on_success: callback при успешном входе
    * page: объект страницы Flet
    * username_field: поле ввода логина
    * password_field: поле ввода пароля
  - Методы:
    * on_login_click(e): обработка входа
    * on_password_key_press(e): обработка Enter
  - Назначение: аутентификация пользователей

ChildrenView (ft.Container):
  - Список детей с формой добавления/редактирования
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * page: объект страницы
    * user_group_id: ID группы пользователя (для фильтрации)
    * selected_child: выбранный ребенок для редактирования
    * current_page: текущая страница пагинации
    * items_per_page: количество элементов на странице (8)
    * all_children: список всех детей
    * search_query: текущий поисковый запрос
  - Методы:
    * load_children(search_query): загрузка списка
    * show_add_form(e): показать форму добавления
    * save_child(e): сохранить ребенка
    * delete_child(child_id): удалить ребенка
    * show_child_detail(child_id): показать детальную информацию
    * on_search(query): поиск
    * prev_page(e), next_page(e): пагинация
    * update_pagination(): обновление пагинации
  - Назначение: управление списком детей

ChildDetailView (ft.Container):
  - Детальная информация о ребенке с вкладками
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * child_id: ID ребенка
    * child: данные ребенка
    * tabs: компонент вкладок
    * parents_column: колонка с родителями
  - Методы:
    * _create_info_tab(): вкладка с общей информацией
    * _create_medical_tab(): вкладка с медкартой
    * _create_parents_tab(): вкладка с родителями
    * edit_child(e): редактирование
    * manage_parents(e): управление родителями
    * _load_parents(): загрузка родителей
  - Назначение: просмотр и редактирование информации о ребенке

ParentsView (ft.Container):
  - Список родителей с формой добавления/редактирования
  - Атрибуты: аналогично ChildrenView
  - Методы:
    * load_parents(search_query): загрузка списка
    * show_add_form(e): показать форму
    * save_parent(e): сохранить родителя
    * delete_parent(parent_id): удалить
    * show_parent_detail(parent_id): детальная информация
    * format_phone(e): форматирование телефона
    * update_phone_hint(e): обновление подсказки
  - Назначение: управление списком родителей

ParentDetailView (ft.Container):
  - Детальная информация о родителе с вкладками
  - Атрибуты:
    * db: экземпляр KindergartenDB
    * parent_id: ID родителя
    * parent_data: данные родителя
    * tabs: компонент вкладок
    * children_column: колонка с детьми
  - Методы:
    * _create_info_tab(): вкладка с информацией
    * _create_children_tab(): вкладка с детьми
    * edit_parent(e): редактирование
    * manage_children(e): управление детьми
    * format_phone(e): форматирование телефона
  - Назначение: просмотр и редактирование информации о родителе

TeachersView (ft.Container):
  - Список воспитателей
  - Атрибуты: аналогично ChildrenView
  - Методы: аналогично ChildrenView
  - Назначение: управление списком воспитателей

TeacherDetailView (ft.Container):
  - Детальная информация о воспитателе с вкладками
  - Вкладки: Общая информация, Группы
  - Назначение: просмотр и редактирование информации о воспитателе

GroupsView (ft.Container):
  - Список групп с формой добавления/редактирования
  - Особенности: поддержка множественного выбора воспитателей
  - Методы:
    * _load_teachers_for_form(): загрузка воспитателей
    * _update_group_teachers(group_id): обновление связей
  - Назначение: управление группами

AttendanceView (ft.Container):
  - Учет посещаемости
  - Атрибуты:
    * selected_date: выбранная дата
    * attendance_data: данные посещаемости
  - Методы:
    * on_date_change(e): изменение даты
    * load_attendance(): загрузка данных
    * save_attendance(e): сохранение
    * on_status_change(e): изменение статуса
  - Назначение: отметка посещаемости детей

EventsView (ft.Container):
  - Список мероприятий
  - Назначение: управление мероприятиями

EventDetailView (ft.Container):
  - Детальная информация о мероприятии
  - Вкладки: Общая информация, Участники
  - Назначение: просмотр и редактирование мероприятия

MedicalCardView (ft.Container):
  - Медицинская карта ребенка
  - Атрибуты:
    * child_id: ID ребенка
    * embedded: режим встраивания
  - Назначение: просмотр и редактирование медкарты

UsersView (ft.Container):
  - Управление пользователями (только для администраторов)
  - Назначение: создание, редактирование, удаление пользователей

LogsView (ft.Container):
  - Журнал действий
  - Атрибуты:
    * user_filter: фильтр по пользователю
    * action_filter: фильтр по действию
    * limit: лимит записей
  - Назначение: просмотр истории действий

SettingsView (ft.Container):
  - Настройки приложения
  - Методы:
    * export_json(e): экспорт в JSON
    * export_csv(e): экспорт в CSV
    * backup_db(e): резервное копирование
    * clear_data(e): очистка данных
    * change_theme(e): смена темы
  - Назначение: управление данными и настройками

4.5. Компоненты:

SearchBar (ft.UserControl):
  - Компонент поиска с иконкой
  - Атрибуты:
    * on_search: callback для поиска
    * placeholder: текст подсказки
  - Назначение: унифицированный поиск

AppStyles:
  - Статические методы для создания стилизованных элементов
  - Методы:
    * text_field(label, required, autofocus): создание поля ввода
    * error_text(): создание текста ошибки
    * form_column(controls, spacing): создание колонки формы
    * page_header(title, button_text, on_click): создание заголовка
  - Назначение: единообразие стилей

AppNavigationDrawer (ft.NavigationDrawer):
  - Боковое меню навигации
  - Атрибуты:
    * switch_view: callback для переключения
    * is_admin: флаг администратора
    * user_permissions: права доступа
  - Назначение: навигация по приложению

5. ОСНОВНЫЕ ФУНКЦИИ И МЕТОДЫ

5.1. Database (database.py):
Методы работы с пользователями:
- create_user(username, password, role, full_name, group_id): создание пользователя
- authenticate_user(username, password): аутентификация
- get_all_users(): получение всех пользователей
- update_user(user_id, **kwargs): обновление данных пользователя
- delete_user(user_id): удаление пользователя
- get_user_group(user_id): получение группы пользователя
- set_user_group(user_id, group_id): установка группы пользователю

Методы работы с детьми:
- add_child(last_name, first_name, middle_name, birth_date, gender, group_id, enrollment_date): добавление ребенка
- get_all_children(): получение всех детей
- get_children_by_group(group_id): получение детей по группе
- get_child_by_id(child_id): получение ребенка по ID
- update_child(child_id, **kwargs): обновление данных ребенка
- delete_child(child_id): удаление ребенка
- search_children(query): поиск детей

Методы работы с родителями:
- add_parent(last_name, first_name, middle_name, phone, email, address): добавление родителя
- get_all_parents(): получение всех родителей
- get_parent_by_id(parent_id): получение родителя по ID
- update_parent(parent_id, **kwargs): обновление данных родителя
- delete_parent(parent_id): удаление родителя
- search_parents(query): поиск родителей
- add_parent_child_relation(parent_id, child_id, relationship): связь родитель-ребенок
- remove_parent_child_relation(parent_id, child_id): удаление связи
- get_parents_by_child(child_id): получение родителей ребенка
- get_children_by_parent(parent_id): получение детей родителя

Методы работы с воспитателями:
- add_teacher(last_name, first_name, middle_name, phone, email, specialization): добавление воспитателя
- get_all_teachers(): получение всех воспитателей
- get_teacher_by_id(teacher_id): получение воспитателя по ID
- update_teacher(teacher_id, **kwargs): обновление данных воспитателя
- delete_teacher(teacher_id): удаление воспитателя
- search_teachers(query): поиск воспитателей
- add_group_teacher_relation(group_id, teacher_id): связь группа-воспитатель
- remove_group_teacher_relation(group_id, teacher_id): удаление связи
- get_teachers_by_group(group_id): получение воспитателей группы
- get_groups_by_teacher(teacher_id): получение групп воспитателя

Методы работы с группами:
- add_group(group_name, age_range): добавление группы
- get_all_groups(): получение всех групп
- get_group_by_id(group_id): получение группы по ID
- update_group(group_id, **kwargs): обновление данных группы
- delete_group(group_id): удаление группы

Методы работы с посещаемостью:
- mark_attendance(child_id, date, status, notes): отметка посещаемости
- get_attendance_by_date(date): получение посещаемости за дату
- get_attendance_by_child(child_id, start_date, end_date): посещаемость ребенка за период
- update_attendance(attendance_id, **kwargs): обновление записи посещаемости

Методы работы с мероприятиями:
- add_event(event_name, event_date, description, group_id): добавление мероприятия
- get_all_events(): получение всех мероприятий
- get_events_by_group(group_id): получение мероприятий группы
- get_event_by_id(event_id): получение мероприятия по ID
- update_event(event_id, **kwargs): обновление мероприятия
- delete_event(event_id): удаление мероприятия
- add_event_participant(event_id, child_id): добавление участника
- remove_event_participant(event_id, child_id): удаление участника
- get_event_participants(event_id): получение участников мероприятия

Методы работы с медицинскими картами:
- add_medical_card(child_id, blood_type, allergies, chronic_diseases, vaccinations, notes): создание медкарты
- get_medical_card_by_child(child_id): получение медкарты ребенка
- update_medical_card(card_id, **kwargs): обновление медкарты

Методы экспорта и управления данными:
- export_to_json(filename): экспорт всех данных в JSON
- export_to_csv(table_name, filename): экспорт таблицы в CSV
- backup_database(backup_path): резервное копирование БД
- clear_all_data(): очистка всех данных
- clear_logs(): очистка журнала действий

5.2. AppLogger (settings/logger.py):
- log(action, username, entity_type, details): запись действия в журнал
- get_logs(user_filter, action_filter, limit): получение записей журнала с фильтрацией

5.3. Конфигурация (settings/config.py):
Константы:
- PRIMARY_COLOR: основной цвет приложения
- GENDERS: словарь полов (М/Ж)
- ATTENDANCE_STATUSES: статусы посещаемости (Присутствует/Отсутствует/Болен/Отпуск)
- USER_ROLES: роли пользователей (admin/user)
- LOG_ACTIONS: типы действий для логирования

6. ОБРАБОТЧИКИ СОБЫТИЙ

6.1. События авторизации (LoginView):
- on_login_click(e): обработка нажатия кнопки "Войти"
- on_password_key_press(e): обработка Enter в поле пароля

6.2. События управления детьми (ChildrenView):
- show_add_form(e): показать форму добавления
- save_child(e): сохранить ребенка
- delete_child(child_id): удалить ребенка
- show_child_detail(child_id): показать детальную информацию
- on_search(query): поиск детей
- prev_page(e), next_page(e): пагинация

6.3. События детального просмотра ребенка (ChildDetailView):
- edit_child(e): редактировать ребенка
- manage_parents(e): управление родителями ребенка
- _load_parents(): загрузка списка родителей

6.4. События управления родителями (ParentsView):
- show_add_form(e): показать форму добавления
- save_parent(e): сохранить родителя
- delete_parent(parent_id): удалить родителя
- show_parent_detail(parent_id): показать детальную информацию
- format_phone(e): форматирование номера телефона
- update_phone_hint(e): обновление подсказки для телефона

6.5. События детального просмотра родителя (ParentDetailView):
- edit_parent(e): редактировать родителя
- manage_children(e): управление детьми родителя
- format_phone(e): форматирование номера телефона

6.6. События управления воспитателями (TeachersView):
- show_add_form(e): показать форму добавления
- save_teacher(e): сохранить воспитателя
- delete_teacher(teacher_id): удалить воспитателя
- show_teacher_detail(teacher_id): показать детальную информацию

6.7. События управления группами (GroupsView):
- show_add_form(e): показать форму добавления
- save_group(e): сохранить группу
- delete_group(group_id): удалить группу
- _load_teachers_for_form(): загрузка воспитателей для формы
- _update_group_teachers(group_id): обновление связей группа-воспитатель

6.8. События посещаемости (AttendanceView):
- on_date_change(e): изменение даты
- load_attendance(): загрузка данных посещаемости
- save_attendance(e): сохранение посещаемости
- on_status_change(e): изменение статуса посещаемости

6.9. События мероприятий (EventsView):
- show_add_form(e): показать форму добавления
- save_event(e): сохранить мероприятие
- delete_event(event_id): удалить мероприятие
- show_event_detail(event_id): показать детальную информацию

6.10. События управления пользователями (UsersView):
- show_add_form(e): показать форму добавления
- save_user(e): сохранить пользователя
- delete_user(user_id): удалить пользователя
- edit_user(user_id): редактировать пользователя

6.11. События настроек (SettingsView):
- export_json(e): экспорт в JSON
- export_csv(e): экспорт в CSV
- backup_db(e): резервное копирование
- clear_data(e): очистка данных
- clear_logs(e): очистка журнала
- change_theme(e): смена темы

6.12. События журнала (LogsView):
- on_user_filter_change(e): фильтр по пользователю
- on_action_filter_change(e): фильтр по действию
- on_limit_change(e): изменение лимита записей
- load_logs(): загрузка журнала

7. СИСТЕМА КОНТРОЛЯ ДОСТУПА

7.1. Роли пользователей:
- admin: полный доступ ко всем функциям
- user: ограниченный доступ в зависимости от назначенной группы

7.2. Группо-ориентированный доступ:
- Пользователи с назначенной группой видят только данные своей группы
- Администраторы видят все данные
- Фильтрация применяется к: детям, родителям, воспитателям, посещаемости, мероприятиям

7.3. Ограничения по действиям:
- Только администраторы могут:
  * Управлять пользователями
  * Удалять данные
  * Экспортировать данные
  * Создавать резервные копии
  * Очищать данные и журнал
  * Управлять воспитателями и группами
- Обычные пользователи могут:
  * Просматривать данные своей группы
  * Редактировать информацию о детях и родителях
  * Отмечать посещаемость
  * Просматривать мероприятия

8. СИСТЕМА ЛОГИРОВАНИЯ

8.1. Типы действий:
- LOGIN: вход в систему
- LOGOUT: выход из системы
- LOGIN_FAILED: неудачная попытка входа
- CREATE: создание записи
- UPDATE: обновление записи
- DELETE: удаление записи
- EXPORT: экспорт данных
- BACKUP: резервное копирование
- CLEAR_DATA: очистка данных
- CLEAR_LOGS: очистка журнала

8.2. Записываемая информация:
- Дата и время действия
- Имя пользователя
- Тип действия
- Тип сущности (User, Child, Parent, Teacher, Group, Event)
- Детали действия

9. ОСОБЕННОСТИ РЕАЛИЗАЦИИ

9.1. Вложенные диалоги:
- Используется page.overlay.append() для диалогов внутри диалогов
- AlertDialog для центрированных диалогов
- BottomSheet для панелей снизу экрана

9.2. Детальные представления с вкладками:
- Использование ft.Tabs для организации информации
- Встраиваемые компоненты (например, MedicalCardView)
- Динамическая загрузка данных при переключении вкладок

9.3. Пагинация:
- Постраничный вывод списков (8 элементов на страницу)
- Кнопки навигации вперед/назад
- Отображение текущей страницы

9.4. Поиск:
- Поиск по нескольким полям одновременно
- Использование SQL LIKE для нечеткого поиска
- Мгновенное обновление результатов

9.5. Валидация данных:
- Проверка обязательных полей
- Отображение ошибок под полями ввода
- Предотвращение дублирования данных

9.6. Форматирование данных:
- Автоматическое форматирование телефонных номеров
- Маски ввода для дат
- Выпадающие списки для стандартизированных значений

10. БАЗА ДАННЫХ

10.1. Тип БД: SQLite
10.2. ORM: Peewee
10.3. Файл БД: kindergarten.db

10.4. Таблицы:
- user: пользователи системы
- child: дети
- parent: родители
- teacher: воспитатели
- group: группы
- event: мероприятия
- attendance: посещаемость
- medicalcard: медицинские карты
- parentchild: связь родитель-ребенок (many-to-many)
- groupteacher: связь группа-воспитатель (many-to-many)
- eventparticipant: участники мероприятий
- log: журнал действий

10.5. Связи:
- Child -> Group (many-to-one)
- Child -> MedicalCard (one-to-one)
- Parent <-> Child (many-to-many через ParentChild)
- Group <-> Teacher (many-to-many через GroupTeacher)
- Event -> Group (many-to-one)
- Event <-> Child (many-to-many через EventParticipant)
- Attendance -> Child (many-to-one)
- User -> Group (many-to-one, опционально)

11. БЕЗОПАСНОСТЬ

11.1. Хеширование паролей:
- Использование SHA-256
- Пароли никогда не хранятся в открытом виде

11.2. Сессии:
- Хранение данных пользователя в client_storage
- Автоматический выход при закрытии приложения

11.3. Валидация ввода:
- Проверка всех пользовательских данных
- Защита от SQL-инъекций через ORM

12. ЭКСПОРТ И РЕЗЕРВНОЕ КОПИРОВАНИЕ

12.1. Форматы экспорта:
- JSON: полный экспорт всех данных
- CSV: экспорт отдельных таблиц

12.2. Резервное копирование:
- Копирование файла базы данных
- Сохранение с меткой времени

12.3. Восстановление:
- Ручное восстановление из резервной копии
- Замена файла kindergarten.db

13. АДАПТИВНОСТЬ И ТЕМЫ

13.1. Темы:
- Светлая тема
- Темная тема
- Автоматическое определение системной темы
- Сохранение выбора пользователя

13.2. Адаптивность:
- Поддержка различных разрешений экрана
- Скроллируемые контейнеры для длинных списков
- Адаптивные диалоги

14. ПРОИЗВОДИТЕЛЬНОСТЬ

14.1. Оптимизация запросов:
- Использование индексов в БД
- Ленивая загрузка данных
- Пагинация для больших списков

14.2. Кэширование:
- Кэширование данных пользователя
- Переиспользование компонентов

15. РАСШИРЯЕМОСТЬ

Архитектура приложения позволяет легко добавлять:
- Новые типы пользователей и роли
- Дополнительные поля в существующие модели
- Новые представления и функции
- Интеграцию с внешними системами
- Дополнительные форматы экспорта
