# Примеры использования детального просмотра групп

## Пример 1: Просмотр информации о группе

```python
# В groups_view.py
def view_group_details(self, group_id: int):
    """Открыть детальное представление группы"""
    from view.group_detail_view import GroupDetailView
    
    if self.page:
        detail_view = GroupDetailView(
            db=self.db,
            group_id=group_id,
            on_back=lambda: self._return_from_detail(),
            page=self.page
        )
        
        # Показываем детальное представление
        self.page.content_area.content = detail_view
        self.page.update()
```

## Пример 2: Создание карточки ребенка

```python
def _create_child_card(self, child):
    """Создать карточку ребенка"""
    full_name = f"{child.get('last_name', '')} {child.get('first_name', '')} {child.get('middle_name', '') or ''}".strip()
    
    # Вычисляем возраст
    age_str = self._calculate_age(child.get('birth_date'))
    gender_icon = ft.Icons.MALE if child.get('gender') == 'М' else ft.Icons.FEMALE
    gender_color = ft.Colors.BLUE if child.get('gender') == 'М' else ft.Colors.PINK
    
    return ft.Card(
        content=ft.Container(
            content=ft.ListTile(
                leading=ft.Icon(gender_icon, color=gender_color, size=30),
                title=ft.Text(full_name, weight=ft.FontWeight.BOLD),
                subtitle=ft.Column([
                    ft.Text(f"Возраст: {age_str}"),
                    ft.Text(f"Дата рождения: {self._format_date(child.get('birth_date'))}")
                ], spacing=2, tight=True),
                trailing=ft.IconButton(
                    icon=ft.Icons.INFO_OUTLINE,
                    tooltip="Подробнее",
                    on_click=lambda e, c=child: self._show_child_details(c)
                )
            ),
            padding=5
        )
    )
```

## Пример 3: Расчет возраста

```python
def _calculate_age(self, birth_date_str):
    """Вычислить возраст"""
    if not birth_date_str:
        return "Не указан"
    
    try:
        if '-' in birth_date_str and len(birth_date_str.split('-')[0]) == 4:
            birth_date_obj = datetime.strptime(birth_date_str, "%Y-%m-%d").date()
        else:
            birth_date_obj = datetime.strptime(birth_date_str, "%d-%m-%Y").date()
        
        today = date.today()
        age = today.year - birth_date_obj.year - ((today.month, today.day) < (birth_date_obj.month, birth_date_obj.day))
        
        # Склонение
        if age % 10 == 1 and age % 100 != 11:
            return f"{age} год"
        elif age % 10 in [2, 3, 4] and age % 100 not in [12, 13, 14]:
            return f"{age} года"
        else:
            return f"{age} лет"
    except:
        return "Не указан"
```

## Пример 4: Построение статистики

```python
def _build_statistics(self):
    """Построение статистики группы"""
    try:
        children = self.db.get_children_by_group(self.group_id)
        teachers = self.db.get_teachers_by_group(self.group_id)
        
        total_children = len(children)
        boys_count = sum(1 for c in children if c.get('gender') == 'М')
        girls_count = total_children - boys_count
        
        # Возрастная статистика
        age_groups = {'0-2': 0, '3-4': 0, '5-6': 0, '7+': 0}
        for child in children:
            age_str = self._calculate_age(child.get('birth_date'))
            try:
                age = int(age_str.split()[0])
                if age <= 2:
                    age_groups['0-2'] += 1
                elif age <= 4:
                    age_groups['3-4'] += 1
                elif age <= 6:
                    age_groups['5-6'] += 1
                else:
                    age_groups['7+'] += 1
            except:
                pass
        
        # Создаем UI для статистики
        self.stats_container.content = ft.Column([
            ft.Card(
                content=ft.Container(
                    content=ft.Column([
                        ft.Text("Общая статистика", size=18, weight=ft.FontWeight.BOLD),
                        ft.Divider(),
                        self._stat_row("Всего детей:", str(total_children), ft.Icons.CHILD_CARE),
                        self._stat_row("Мальчиков:", str(boys_count), ft.Icons.MALE, ft.Colors.BLUE),
                        self._stat_row("Девочек:", str(girls_count), ft.Icons.FEMALE, ft.Colors.PINK),
                        self._stat_row("Воспитателей:", str(len(teachers)), ft.Icons.PERSON)
                    ], spacing=10),
                    padding=20
                )
            )
        ], spacing=10, scroll=ft.ScrollMode.AUTO)
        
    except Exception as ex:
        self.stats_container.content = ft.Text(f"Ошибка загрузки статистики: {str(ex)}", color=ft.Colors.ERROR)
```

## Пример 5: Использование в базе данных

```python
# Получение информации о группе
group = db.get_group_by_id(group_id)

# Получение детей группы
children = db.get_children_by_group(group_id)

# Получение воспитателей группы
teachers = db.get_teachers_by_group(group_id)

# Пример данных группы
{
    'group_id': 1,
    'group_name': 'Солнышко',
    'age_category': 'Средняя (4-5 лет)',
    'teacher_id': 1,
    'created_at': '2024-01-15T10:30:00',
    'teacher_name': 'Иванова Мария Петровна'
}

# Пример данных ребенка
{
    'child_id': 1,
    'last_name': 'Петров',
    'first_name': 'Иван',
    'middle_name': 'Сергеевич',
    'birth_date': '2019-05-15',
    'gender': 'М',
    'group_id': 1,
    'enrollment_date': '2023-09-01',
    'group_name': 'Солнышко'
}
```

## Интеграция с существующим кодом

### Добавление кнопки просмотра в меню группы

```python
ft.PopupMenuItem(
    text="Просмотр", 
    icon=ft.Icons.VISIBILITY, 
    on_click=lambda _, gid=group['group_id']: self.view_group_details(gid)
)
```

### Навигация между представлениями

```python
# Переход к детальному представлению
self.page.content_area.content = detail_view
self.page.update()

# Возврат к списку групп
self.page.content_area.content = self
self.load_groups()
self.page.update()
```
